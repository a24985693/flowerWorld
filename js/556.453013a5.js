"use strict";(self["webpackChunkfinal_hw"]=self["webpackChunkfinal_hw"]||[]).push([[556],{7649:function(t,s,e){e(4114);var o=e(4445),i=e(1250),a=e(9325),c=e(8465),r=e.n(c),n=e(9040);const l=(0,n.A)();s.A=(0,o.nY)("cart",{state:()=>({cart:{},cartLength:"",couponWarning:"",btnLoading:"",isLoading:!1}),actions:{getCart(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cms67/cart";i.A.get(t).then((t=>{this.isLoading=!1,this.cart=t.data.data,this.cartLength=this.cart.carts.length})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車取得失敗"})}))},updateCart(t,s){this.isLoading=!0;let e=s;e>20?e=20:e<1&&(e=1);const o=`https://vue3-course-api.hexschool.io/api/cms67/cart/${t.id}`,a={product_id:t.product_id,qty:e};i.A.put(o,{data:a}).then((()=>{this.getCart()})).catch((()=>{l.pushMessage({style:"danger",title:"數量修改失敗"})}))},addtoCart(t,s=1){let e;this.btnLoading=t.id,this.cart.carts?e=this.cart.carts.filter((s=>s.product_id===t.id)):this.getCart();const o="https://vue3-course-api.hexschool.io/api/cms67/cart",a={product_id:t.id,qty:s};i.A.post(o,{data:a}).then((t=>{this.btnLoading="";const{title:s}=t.data.data.product;if(t.data.data.qty>20){const t="已加入到最大數量";l.pushMessage({style:"warning",title:t,content:`購物車內目前已有20件${s}`}),this.updateCart(e[0],20)}else{const t="加入成功";l.pushMessage({style:"success",title:t,content:`已將${s}加入購物車`}),this.getCart()}})).catch((()=>{this.btnLoading="",l.pushMessage({style:"danger",title:"購物車加入失敗"})}))},deleteCartItem(t){this.isLoading=!0;const s=`https://vue3-course-api.hexschool.io/api/cms67/cart/${t.id}`;i.A.delete(s).then((()=>{this.getCart();const s="已移除品項";l.pushMessage({style:"danger",title:s,content:`已將${t.product.title}移除`})})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車刪除失敗"})}))},confirmDeleteAll(){r().fire({text:"確定要將清空購物車嗎",icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.deleteAll()}))},deleteAll(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cms67/carts";i.A.delete(t).then((()=>{this.getCart();const t="已移除全部品項";l.pushMessage({style:"danger",title:t,content:"已將全部品項移除"})})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車刪除失敗"})}))},addCouponCode(t){this.isLoading=!0;const s="https://vue3-course-api.hexschool.io/api/cms67/coupon",e={code:t};i.A.post(s,{data:e}).then((t=>{t.data.success?(this.getCart(),this.couponWarning=""):(this.isLoading=!1,this.couponWarning="找不到優惠券")})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"優惠券加入失敗"})}))},returnPage(){a.A.go(-1)},returnIndex(){a.A.push("/index")},gotoShop(){a.A.push("/productsList")}}})},3497:function(t,s,e){e(4114);var o=e(4445),i=e(1250),a=e(9325),c=e(8465),r=e.n(c),n=e(9040);const l=(0,n.A)();s.A=(0,o.nY)("order",{state:()=>({couponCode:"",order:{user:{}},originalTotal:0,searchOrder:{},warning:"",isLoading:!1}),actions:{createOrder(t){this.isLoading=!0;const s="https://vue3-course-api.hexschool.io/api/cms67/order";i.A.post(s,{data:t}).then((t=>{this.isLoading=!1,a.A.push(`/checkout/${t.data.orderId}`)})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"訂單建立失敗"})}))},confirmCreateOrder(t){r().fire({title:"確定表單資料",text:"表單送出後將不能修改訂單!",icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((s=>{s.isConfirmed&&this.createOrder(t)}))},getOrder(t,s){if(this.isLoading=!0,t){const e=`https://vue3-course-api.hexschool.io/api/cms67/order/${t}`;i.A.get(e).then((t=>{if(this.isLoading=!1,t.data.order){s?this.searchOrder=t.data.order:this.order=t.data.order;const e=Object.keys(t.data.order.products)[0],o=t.data.order.products[e];o.coupon&&(this.couponCode=o.coupon.code)}else this.warning="訂單號碼輸入錯誤，請重新輸入";this.getOriginalTotal(t.data.order)})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"訂單取得失敗"})}))}else this.isLoading=!1,this.warning="訂單號碼不可為空，請輸入訂單號碼"},getOriginalTotal(t){const s=Object.values(t.products).map((t=>t.total));this.originalTotal=0,s.forEach((t=>{this.originalTotal+=t}))},payOrder(){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/cms67/pay/${this.order.id}`;i.A.post(t).then((t=>{if(this.isLoading=!1,t.data.success){this.getOrder(this.order.id);const t="付款成功";l.pushMessage({style:"success",title:t,content:"已完成付款"})}})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"付款失敗"})}))},gotoPay(t){a.A.push(`/checkout/${t}`)}}})},2556:function(t,s,e){e.r(s),e.d(s,{default:function(){return At}});var o=e(641),i=e(33);const a={class:"page-title"},c=(0,o.Lk)("h2",null,"付款",-1),r={"aria-label":"breadcrumb"},n={class:"breadcrumb d-flex justify-content-center"},l={class:"breadcrumb-item"},d=(0,o.Lk)("li",{class:"breadcrumb-item active"}," 付款 ",-1),u={class:"container"},p=(0,o.Fv)('<div class="row justify-content-center text-center mb-5"><div class="col-4 col-md-3"><div class="pay-step border"><span>1</span></div><span>確認訂單</span></div><div class="col-4 col-md-3"><div class="pay-step border"><span>2</span></div><span>填寫資料</span></div><div class="col-4 col-md-3"><div class="pay-step bg-info text-white"><span>3</span></div><span>付款</span></div></div>',1),h={key:0,class:"row g-4"},g={class:"col-12 col-lg-8"},L={class:"border border-2 border-info"},v=(0,o.Lk)("div",{class:"w-100 bg-info text-white fs-5 text-center py-2"}," 訂單明細 ",-1),k={class:"py-4 px-3"},b={class:"row border-bottom py-2"},m=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"訂單編號",-1),f={class:"col-12 col-sm-8"},y={class:"row border-bottom py-2"},x=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"Email",-1),w={class:"col-12 col-sm-8"},C={class:"row border-bottom py-2"},A=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"收件人姓名",-1),_={class:"col-12 col-sm-8"},O={class:"row border-bottom py-2"},M=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"收件人電話",-1),T={class:"col-12 col-sm-8"},$={class:"row border-bottom py-2"},I=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"收件人地址",-1),E={class:"col-12 col-sm-8"},j={class:"row border-bottom py-2"},X=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"留言",-1),B={class:"col-12 col-sm-8"},F={class:"row border-bottom py-2 mb-4"},S=(0,o.Lk)("div",{class:"col-12 col-sm-4 fw-semibold"},"付款狀態",-1),q={class:"col-12 col-sm-8"},W={key:0,class:"text-danger"},Q={key:1,class:"text-success"},K={key:0,class:"row flex-column flex-md-row"},N=(0,o.Lk)("div",{class:"col-12"},[(0,o.Lk)("i",{class:"fa-solid fa-triangle-exclamation me-2"}),(0,o.Lk)("span",{class:"fw-semibold"},"訂單尚未完成!"),(0,o.Lk)("p",null,"確認訂單內容後，點擊付款即完成訂單!")],-1),P=[N],Y={class:"col-12 col-lg-4"},D={class:"border border-2 border-info"},H=(0,o.Lk)("div",{class:"w-100 bg-info text-white fs-5 text-center py-2"}," 訂單明細 ",-1),z={class:"py-4 px-3"},G={class:"col-5"},J={class:"col-2 text-center"},R={class:"col-5 text-end"},U={class:"my-3"},V={class:"d-flex justify-content-between mb-1"},Z=(0,o.Lk)("p",null,"小計",-1),tt={key:0,class:"d-flex justify-content-between text-muted mb-1"},st=(0,o.Lk)("p",null,"折扣",-1),et={key:1,class:"d-flex justify-content-between text-muted mb-1"},ot=(0,o.Lk)("p",null,"已使用優惠券",-1),it=(0,o.Lk)("hr",null,null,-1),at={class:"d-flex justify-content-between fs-5 fw-semibold mb-3"},ct=(0,o.Lk)("p",null,"總計",-1),rt={key:1,class:"row justify-content-center py-5 gy-3 border border-2 border-info"},nt={class:"col-12 text-center"},lt=(0,o.Lk)("i",{class:"fa-regular fa-circle-check text-info fs-120 mb-3"},null,-1),dt=(0,o.Lk)("h3",{class:"mb-4"},"付款完成",-1),ut={class:"mb-3"},pt=(0,o.Lk)("span",null,"訂單編號：",-1),ht=(0,o.Lk)("i",{class:"fa-solid fa-copy"},null,-1),gt=[ht],Lt=(0,o.Lk)("p",null,"感謝您的訂購！您的訂單已成功付款，我們將盡快為您安排配送。",-1),vt={class:"col-12 text-center"};function kt(t,s,e,N,ht,kt){const bt=(0,o.g2)("LoadingSpinner"),mt=(0,o.g2)("router-link");return(0,o.uX)(),(0,o.CE)(o.FK,null,[(0,o.bF)(bt,{active:t.isLoading},null,8,["active"]),(0,o.Lk)("section",a,[c,(0,o.Lk)("nav",r,[(0,o.Lk)("ol",n,[(0,o.Lk)("li",l,[(0,o.bF)(mt,{to:"/",class:"text-decoration-none text-light"},{default:(0,o.k6)((()=>[(0,o.eW)(" 首頁 ")])),_:1})]),d])])]),(0,o.Lk)("div",u,[p,t.order.is_paid?((0,o.uX)(),(0,o.CE)("div",rt,[(0,o.Lk)("div",nt,[lt,dt,(0,o.Lk)("div",ut,[pt,(0,o.Lk)("span",{ref:"orderId"},(0,i.v_)(t.order.id),513),(0,o.Lk)("button",{class:"btn py-0 fs-5",onClick:s[1]||(s[1]=(...t)=>kt.copyOrderId&&kt.copyOrderId(...t)),ref:"copyBtn"},gt,512)]),Lt]),(0,o.Lk)("div",vt,[(0,o.Lk)("button",{class:"btn btn-outline-gray ms-3",onClick:s[2]||(s[2]=(...s)=>t.returnIndex&&t.returnIndex(...s))}," 回到首頁 "),(0,o.Lk)("button",{class:"btn btn-secondary ms-3",onClick:s[3]||(s[3]=(...s)=>t.gotoShop&&t.gotoShop(...s))}," 繼續購物 ")])])):((0,o.uX)(),(0,o.CE)("div",h,[(0,o.Lk)("div",g,[(0,o.Lk)("div",L,[v,(0,o.Lk)("div",k,[(0,o.Lk)("div",b,[m,(0,o.Lk)("div",f,(0,i.v_)(t.order.id),1)]),(0,o.Lk)("div",y,[x,(0,o.Lk)("div",w,(0,i.v_)(t.order.user.email),1)]),(0,o.Lk)("div",C,[A,(0,o.Lk)("div",_,(0,i.v_)(t.order.user.name),1)]),(0,o.Lk)("div",O,[M,(0,o.Lk)("div",T,(0,i.v_)(t.order.user.tel),1)]),(0,o.Lk)("div",$,[I,(0,o.Lk)("div",E,(0,i.v_)(t.order.user.address),1)]),(0,o.Lk)("div",j,[X,(0,o.Lk)("div",B,(0,i.v_)(t.order.message),1)]),(0,o.Lk)("div",F,[S,(0,o.Lk)("div",q,[t.order.is_paid?((0,o.uX)(),(0,o.CE)("span",Q,"付款完成")):((0,o.uX)(),(0,o.CE)("span",W,"尚未付款"))])]),t.order.is_paid?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("div",K,P))])])]),(0,o.Lk)("div",Y,[(0,o.Lk)("div",D,[H,(0,o.Lk)("div",z,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(t.order.products,(s=>((0,o.uX)(),(0,o.CE)("div",{key:s.id,class:"row justify-content-center border-bottom py-2"},[(0,o.Lk)("p",G,(0,i.v_)(s.product.title),1),(0,o.Lk)("p",J,"x"+(0,i.v_)(s.qty),1),(0,o.Lk)("p",R," NT$"+(0,i.v_)(t.$filters.currency(s.total)),1)])))),128)),(0,o.Lk)("div",U,[(0,o.Lk)("div",V,[Z,(0,o.Lk)("p",null,(0,i.v_)(t.originalTotal),1)]),t.couponCode?((0,o.uX)(),(0,o.CE)("div",tt,[st,(0,o.Lk)("p",null,(0,i.v_)(t.originalTotal-t.order.total),1)])):(0,o.Q3)("",!0),t.couponCode?((0,o.uX)(),(0,o.CE)("div",et,[ot,(0,o.Lk)("p",null,(0,i.v_)(t.couponCode),1)])):(0,o.Q3)("",!0)]),it,(0,o.Lk)("div",at,[ct,(0,o.Lk)("p",null,"NT$"+(0,i.v_)(t.$filters.currency(t.order.total)),1)]),(0,o.Lk)("button",{type:"button",class:"btn btn-secondary w-100 fw-bold",onClick:s[0]||(s[0]=(...s)=>t.payOrder&&t.payOrder(...s))}," 確認付款 ")])])])]))])],64)}var bt=e(7649),mt=e(3497),ft=e(9040),yt=e(4445),xt={computed:{...(0,yt.aH)(mt.A,["couponCode","order","isLoading","originalTotal"])},methods:{...(0,yt.i0)(bt.A,["returnIndex","gotoShop"]),...(0,yt.i0)(mt.A,["getOrder","payOrder"]),...(0,yt.i0)(ft.A,["pushMessage"]),copyOrderId(){navigator.clipboard.writeText(this.$refs.orderId.textContent);const t="複製成功";this.pushMessage({style:"success",title:t,content:"已複製"})}},created(){this.getOrder(this.$route.params.orderId)}},wt=e(6262);const Ct=(0,wt.A)(xt,[["render",kt]]);var At=Ct}}]);
//# sourceMappingURL=556.453013a5.js.map