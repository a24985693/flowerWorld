"use strict";(self["webpackChunkfinal_hw"]=self["webpackChunkfinal_hw"]||[]).push([[132],{4132:function(t,e,i){i.r(e),i.d(e,{default:function(){return mt}});var a=i(641),l=i(33);const s={class:"text-end"},n={class:"table-responsive"},o={class:"table text-nowrap"},c=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",null,"標籤"),(0,a.Lk)("th",null,"標題"),(0,a.Lk)("th",{width:"120"},"創作時間"),(0,a.Lk)("th",{width:"120"},"作者"),(0,a.Lk)("th",{width:"100"},"是否啟用"),(0,a.Lk)("th",{width:"200"},"編輯")])],-1),d={key:0,class:"text-success"},r={key:1,class:"text-muted"},u={class:"btn-group"},p=["onClick"],h=["onClick"];function m(t,e,i,m,g,L){const b=(0,a.g2)("LoadingSpinner"),k=(0,a.g2)("PageNavigation"),f=(0,a.g2)("ArticleModal");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(b,{active:t.isLoading},null,8,["active"]),(0,a.Lk)("div",s,[(0,a.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:e[0]||(e[0]=t=>L.openModal(!0))}," 新增文章 ")]),(0,a.Lk)("div",n,[(0,a.Lk)("table",o,[c,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.articles,(e=>((0,a.uX)(),(0,a.CE)("tr",{key:e.id},[(0,a.Lk)("td",null,(0,l.v_)(e.tag),1),(0,a.Lk)("td",null,(0,l.v_)(e.title),1),(0,a.Lk)("td",null,(0,l.v_)(t.$filters.date(e.create_at)),1),(0,a.Lk)("td",null,(0,l.v_)(e.author),1),(0,a.Lk)("td",null,[e.isPublic?((0,a.uX)(),(0,a.CE)("span",d,"公開")):((0,a.uX)(),(0,a.CE)("span",r,"未公開"))]),(0,a.Lk)("td",null,[(0,a.Lk)("div",u,[(0,a.Lk)("button",{class:"btn btn-outline-gray btn-sm",type:"button",onClick:t=>L.openModal(!1,e)},"編輯",8,p),(0,a.Lk)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:i=>t.comfirmDelArticle(e)},"刪除",8,h)])])])))),128))])])]),(0,a.bF)(k,{pagination:t.pagination,onUpdatePage:t.getArticles},null,8,["pagination","onUpdatePage"]),(0,a.bF)(f,{ref:"ArticleModal"},null,512)],64)}var g=i(3751);const L={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},b={class:"modal-dialog modal-lg",role:"document"},k={class:"modal-content border-0"},f={class:"modal-header bg-dark text-white"},A={class:"modal-title",id:"exampleModalLabel"},v={key:0},y={key:1},w=(0,a.Lk)("button",{type:"button",class:"btn-close text-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),x={class:"modal-body"},C={class:"modal-body"},M={class:"mb-3"},U=(0,a.Lk)("label",{for:"tag"},"請輸入標籤",-1),F={class:"mb-3"},_=(0,a.Lk)("label",{for:"title"},"請輸入標題",-1),E={class:"mb-3"},N=(0,a.Lk)("label",{for:"author"},"請輸入作者",-1),X={class:"mb-3"},$=(0,a.Lk)("label",{for:"content"},"請輸入內容",-1),D={class:"mb-3"},P=(0,a.Lk)("label",{for:"create_at"},"創作日期",-1),V={class:"mb-3"},J=(0,a.Lk)("label",{for:"is_public"},"是否公開",-1),j=(0,a.Lk)("hr",null,null,-1),T={class:"my-5"},B={class:"mb-5"},H={for:"imageUrl",class:"form-label w-100"},S={class:"mb-3 input-group"},I={type:"text",class:"form-control",id:"imageUrl",placeholder:"請輸入圖片連結",ref:"inputLink"},K=(0,a.Lk)("label",{for:"customFile",class:"form-label"},"或上傳圖片",-1),Q={key:0,class:"fas fa-spinner fa-spin"},O={key:0,class:"row justify-content-center"},W={class:"col-md-6"},Y=["src"],q={class:"mb-3 input-group"},z={class:"modal-footer"},G=(0,a.Lk)("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1);function R(t,e,i,l,s,n){return(0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("div",b,[(0,a.Lk)("div",k,[(0,a.Lk)("div",f,[(0,a.Lk)("h5",A,[s.article.id?((0,a.uX)(),(0,a.CE)("span",v,"編輯文章")):((0,a.uX)(),(0,a.CE)("span",y,"新增文章"))]),w]),(0,a.Lk)("div",x,[(0,a.Lk)("div",C,[(0,a.Lk)("div",M,[U,(0,a.bo)((0,a.Lk)("input",{type:"text",class:"form-control",id:"tag","onUpdate:modelValue":e[0]||(e[0]=t=>s.article.tag=t)},null,512),[[g.Jo,s.article.tag]])]),(0,a.Lk)("div",F,[_,(0,a.bo)((0,a.Lk)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[1]||(e[1]=t=>s.article.title=t)},null,512),[[g.Jo,s.article.title]])]),(0,a.Lk)("div",E,[N,(0,a.bo)((0,a.Lk)("input",{type:"text",class:"form-control",id:"author","onUpdate:modelValue":e[2]||(e[2]=t=>s.article.author=t)},null,512),[[g.Jo,s.article.author]])]),(0,a.Lk)("div",X,[$,(0,a.bo)((0,a.Lk)("textarea",{type:"text",class:"form-control",id:"content","onUpdate:modelValue":e[3]||(e[3]=t=>s.article.content=t)},null,512),[[g.Jo,s.article.content]])]),(0,a.Lk)("div",D,[P,(0,a.bo)((0,a.Lk)("input",{type:"date",class:"form-control",id:"create_at","onUpdate:modelValue":e[4]||(e[4]=t=>s.createdAt=t)},null,512),[[g.Jo,s.createdAt]])]),(0,a.Lk)("div",V,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",class:"form-check-input",id:"is_public","onUpdate:modelValue":e[5]||(e[5]=t=>s.article.isPublic=t)},null,512),[[g.lH,s.article.isPublic]]),J]),j,(0,a.Lk)("div",T,[(0,a.Lk)("div",B,[(0,a.Lk)("label",H,[(0,a.eW)("輸入圖片網址 "),(0,a.Lk)("div",S,[(0,a.Lk)("input",I,null,512),(0,a.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:e[6]||(e[6]=(...t)=>n.sendUploadLink&&n.sendUploadLink(...t))}," 新增圖片 ")])]),K,t.btnLoading?((0,a.uX)(),(0,a.CE)("i",Q)):(0,a.Q3)("",!0),(0,a.Lk)("input",{type:"file",id:"customFile",class:"form-control mb-3",onChange:e[7]||(e[7]=(...t)=>n.sendUploadFile&&n.sendUploadFile(...t)),ref:"inputFile"},null,544)]),s.article.image?((0,a.uX)(),(0,a.CE)("div",O,[(0,a.Lk)("div",W,[(0,a.Lk)("img",{class:"img-fluid object-fit-cover",alt:"圖片",src:s.article.image},null,8,Y),(0,a.Lk)("div",q,[(0,a.bo)((0,a.Lk)("input",{type:"url",class:"form-control",placeholder:"請輸入連結","onUpdate:modelValue":e[8]||(e[8]=t=>s.article.image=t)},null,512),[[g.Jo,s.article.image]]),(0,a.Lk)("button",{type:"button",class:"btn btn-outline-danger",onClick:e[9]||(e[9]=t=>{s.article.image=""})}," 移除 ")])])])):(0,a.Q3)("",!0)])])]),(0,a.Lk)("div",z,[G,(0,a.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:e[10]||(e[10]=t=>n.sendUpdateArticle())},"確認")])])])],512)}var Z=i(3286),tt=i(4445),et=i(1250),it=i(8465),at=i.n(it),lt=i(9040);const st=(0,lt.A)();var nt=(0,tt.nY)("adminArticle",{state:()=>({articles:[],pagination:{},tempArticle:{},isNew:!1,isLoading:!1,btnLoading:!1}),actions:{getArticles(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/admin/articles?page=${t}`;et.A.get(e).then((t=>{this.isLoading=!1,this.articles=t.data.articles,this.pagination=t.data.pagination})).catch((()=>{this.isLoading=!1,st.pushMessage({style:"danger",title:"文章列表取得失敗",content:"請稍後嘗試"})}))},getArticle(t,e){if(this.isLoading=!0,this.isNew=t,this.isNew)this.tempArticle={create_at:(new Date).getTime()/1e3},this.isLoading=!1;else{const t=`https://vue3-course-api.hexschool.io/api/cms67/admin/article/${e.id}`;et.A.get(t).then((t=>{this.isLoading=!1,this.tempArticle={...e},this.tempArticle.content=t.data.article.content})).catch((()=>{this.isLoading=!1,st.pushMessage({style:"danger",title:"文章取得失敗",content:"請稍後嘗試"})}))}},updateArticle(t){this.isLoading=!0,this.tempArticle=t;let e="https://vue3-course-api.hexschool.io/api/cms67/admin/article",i="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/cms67/admin/article/${t.id}`,i="put"),et.A[i](e,{data:this.tempArticle}).then((t=>{let e=this.isNew?"新增成功":"更新成功";t.data.success?(this.getArticles(),st.pushMessage({style:"success",title:e})):(this.isLoading=!1,e=this.isNew?"新增失敗":"更新失敗",st.pushMessage({style:"danger",title:e,content:t.data.message.join("、")}))})).catch((()=>{this.isLoading=!1;const t=this.isNew?"新增失敗":"更新失敗";st.pushMessage({style:"danger",title:t,content:"請稍後嘗試"})}))},updateCreateAt(t){this.tempArticle.create_at=t},comfirmDelArticle(t){at().fire({title:"確定刪除嗎",text:`確定要${t.title}刪除嗎`,icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((e=>{e.isConfirmed&&this.deleteArticle(t)}))},deleteArticle(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/admin/article/${t.id}`;et.A.delete(e).then((t=>{this.isLoading=!1,t.data.success?(this.getArticles(),st.pushMessage({style:"success",title:"刪除成功"})):st.pushMessage({style:"danger",title:"刪除失敗",content:t.data.message.join("、")})})).catch((()=>{this.isLoading=!1,st.pushMessage({style:"danger",title:"刪除失敗",content:"請稍後嘗試"})}))},uploadFile(t){this.btnLoading=!0;const e=new FormData;e.append("file-to-upload",t);const i="https://vue3-course-api.hexschool.io/api/cms67/admin/upload";et.A.post(i,e).then((t=>{this.btnLoading=!1,this.tempArticle.image=t.data.imageUrl})).catch((()=>{this.btnLoading=!1,st.pushMessage({style:"danger",title:"上傳失敗",content:"請稍後嘗試"})}))},uploadLink(t){this.tempArticle.image=t}}}),ot={watch:{tempArticle(){this.article=this.tempArticle;const t=new Date(1e3*this.article.create_at).toISOString().split("T");[this.createdAt]=t},createdAt(){this.article.create_at=Math.floor(new Date(this.createdAt)/1e3),this.updateCreateAt(this.article.create_at)}},data(){return{article:{},createdAt:""}},mixins:[Z.A],computed:{...(0,tt.aH)(nt,["tempArticle","btnLoading"])},methods:{...(0,tt.i0)(nt,["updateArticle","updateCreateAt","uploadFile","uploadLink"]),sendUpdateArticle(){this.updateArticle(this.article,this.createdAt),this.hideModal()},sendUploadFile(){const t=this.$refs.inputFile.files[0];this.uploadFile(t)},sendUploadLink(){this.uploadLink(this.$refs.inputLink.value),this.$refs.inputLink.value=""}}},ct=i(6262);const dt=(0,ct.A)(ot,[["render",R]]);var rt=dt,ut=i(9060),pt={components:{ArticleModal:rt,PageNavigation:ut.A},computed:{...(0,tt.aH)(nt,["articles","pagination","isNew","isLoading"])},methods:{...(0,tt.i0)(nt,["getArticles","getArticle","comfirmDelArticle"]),openModal(t,e){this.getArticle(t,e),this.$refs.ArticleModal.showModal()}},created(){this.getArticles()}};const ht=(0,ct.A)(pt,[["render",m]]);var mt=ht}}]);
//# sourceMappingURL=132.a4aef867.js.map