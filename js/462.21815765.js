"use strict";(self["webpackChunkfinal_hw"]=self["webpackChunkfinal_hw"]||[]).push([[462],{1462:function(t,e,o){o.r(e),o.d(e,{default:function(){return Z}});var n=o(641),s=o(33);const a={class:"text-end"},i={class:"table-responsive"},l={class:"table text-nowrap"},u=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"名稱"),(0,n.Lk)("th",null,"折扣百分比"),(0,n.Lk)("th",null,"到期日"),(0,n.Lk)("th",null,"是否啟用"),(0,n.Lk)("th",null,"編輯")])],-1),d={key:0,class:"text-success"},p={key:1,class:"text-muted"},c={class:"btn-group"},h=["onClick"],r=["onClick"];function m(t,e,o,m,b,g){const k=(0,n.g2)("LoadingSpinner"),L=(0,n.g2)("CouponModal"),C=(0,n.g2)("PageNavigation");return(0,n.uX)(),(0,n.CE)(n.FK,null,[(0,n.bF)(k,{active:t.isLoading},null,8,["active"]),(0,n.Lk)("div",a,[(0,n.Lk)("button",{class:"btn btn-secondary",type:"button",onClick:e[0]||(e[0]=t=>g.openModal(!0))},"新增優惠券 ")]),(0,n.Lk)("div",i,[(0,n.Lk)("table",l,[u,(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(t.coupons,(e=>((0,n.uX)(),(0,n.CE)("tr",{key:e.id},[(0,n.Lk)("td",null,(0,s.v_)(e.title),1),(0,n.Lk)("td",null,(0,s.v_)(e.percent)+"%",1),(0,n.Lk)("td",null,(0,s.v_)(t.$filters.date(e.due_date)),1),(0,n.Lk)("td",null,[e.is_enabled?((0,n.uX)(),(0,n.CE)("span",d,"啟用")):((0,n.uX)(),(0,n.CE)("span",p,"未啟用"))]),(0,n.Lk)("td",null,[(0,n.Lk)("div",c,[(0,n.Lk)("button",{class:"btn btn-outline-gray btn-sm",type:"button",onClick:t=>g.openModal(!1,e)},"編輯",8,h),(0,n.Lk)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:o=>t.comfirmDelCoupon(e)},"刪除",8,r)])])])))),128))])])]),(0,n.bF)(L,{ref:"CouponModal"},null,512),(0,n.bF)(C,{pagination:t.pagination,onUpdatePage:t.getCoupons},null,8,["pagination","onUpdatePage"])],64)}var b=o(3751);const g={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},k={class:"modal-dialog modal-lg"},L={class:"modal-content"},C={class:"modal-header bg-dark text-white"},f={class:"modal-title",id:"exampleModalLabel"},v={key:0},y={key:1},M=(0,n.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),w={class:"modal-body"},x={class:"mb-3"},D=(0,n.Lk)("label",{for:"title"},"請輸入標題",-1),_={class:"mb-3"},U=(0,n.Lk)("label",{for:"code"},"請輸入優惠碼",-1),N={class:"mb-3"},A=(0,n.Lk)("label",{for:"dueDate"},"到期日",-1),E={class:"mb-3"},X=(0,n.Lk)("label",{for:"price"},"請輸入折扣百分比",-1),$={class:"mb-3"},P=(0,n.Lk)("label",{for:"is_enabled"},"是否啟用",-1),F={class:"modal-footer"},V=(0,n.Lk)("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1);function J(t,e,o,s,a,i){return(0,n.uX)(),(0,n.CE)("div",g,[(0,n.Lk)("div",k,[(0,n.Lk)("div",L,[(0,n.Lk)("div",C,[(0,n.Lk)("h5",f,[a.coupon.id?((0,n.uX)(),(0,n.CE)("span",v,"編輯優惠券")):((0,n.uX)(),(0,n.CE)("span",y,"新增優惠券"))]),M]),(0,n.Lk)("div",w,[(0,n.Lk)("div",x,[D,(0,n.bo)((0,n.Lk)("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=t=>a.coupon.title=t)},null,512),[[b.Jo,a.coupon.title]])]),(0,n.Lk)("div",_,[U,(0,n.bo)((0,n.Lk)("input",{type:"text",class:"form-control",id:"code","onUpdate:modelValue":e[1]||(e[1]=t=>a.coupon.code=t)},null,512),[[b.Jo,a.coupon.code]])]),(0,n.Lk)("div",N,[A,(0,n.bo)((0,n.Lk)("input",{type:"date",class:"form-control",id:"dueDate","onUpdate:modelValue":e[2]||(e[2]=t=>a.dueDate=t)},null,512),[[b.Jo,a.dueDate]])]),(0,n.Lk)("div",E,[X,(0,n.bo)((0,n.Lk)("input",{type:"number",class:"form-control",id:"price","onUpdate:modelValue":e[3]||(e[3]=t=>a.coupon.percent=t)},null,512),[[b.Jo,a.coupon.percent]])]),(0,n.Lk)("div",$,[(0,n.bo)((0,n.Lk)("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=t=>a.coupon.is_enabled=t)},null,512),[[b.lH,a.coupon.is_enabled]]),P])]),(0,n.Lk)("div",F,[V,(0,n.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:e[5]||(e[5]=(...t)=>i.sendUpdateCoupon&&i.sendUpdateCoupon(...t))},"確認")])])])],512)}var T=o(3286),B=o(4445),H=o(1250),S=o(8465),j=o.n(S),I=o(9040);const K=(0,I.A)();var O=(0,B.nY)("adminCoupon",{state:()=>({coupons:[],tempCoupon:{},pagination:{},isNew:!1,isLoading:!1}),actions:{getCoupons(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/admin/coupons?page=${t}`;H.A.get(e).then((t=>{this.isLoading=!1,this.coupons=t.data.coupons,this.pagination=t.data.pagination})).catch((()=>{this.isLoading=!1,K.pushMessage({style:"danger",title:"優惠券列表取得失敗",content:"請稍後嘗試"})}))},getCoupon(t,e){this.isNew=t,this.tempCoupon=t?{due_date:(new Date).getTime()/1e3}:{...e}},updateCoupon(t){this.isLoading=!0,this.tempProduct=t;let e="https://vue3-course-api.hexschool.io/api/cms67/admin/coupon",o="post";this.isNew||(e=`https://vue3-course-api.hexschool.io/api/cms67/admin/coupon/${t.id}`,o="put"),H.A[o](e,{data:this.tempProduct}).then((t=>{let e=this.isNew?"新增成功":"更新成功";t.data.success?(this.getCoupons(),K.pushMessage({style:"success",title:e})):(this.isLoading=!1,e=this.isNew?"新增失敗":"更新失敗",K.pushMessage({style:"danger",title:e,content:t.data.message.join("、")}))})).catch((()=>{this.isLoading=!1;const t=this.isNew?"新增失敗":"更新失敗";K.pushMessage({style:"danger",title:t,content:"請稍後嘗試"})}))},comfirmDelCoupon(t){j().fire({title:"確定刪除嗎",text:`確定要${t.title}刪除嗎`,icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((e=>{e.isConfirmed&&this.deleteCoupon(t)}))},deleteCoupon(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/admin/coupon/${t.id}`;H.A.delete(e).then((t=>{this.getCoupons(),t.data.success?K.pushMessage({style:"success",title:"刪除成功"}):(this.isLoading=!1,K.pushMessage({style:"danger",title:"刪除失敗",content:t.data.message.join("、")}))})).catch((()=>{this.isLoading=!1,K.pushMessage({style:"danger",title:"優惠券刪除失敗",content:"請稍後嘗試"})}))}}}),Y={mixins:[T.A],watch:{tempCoupon(){this.coupon=this.tempCoupon;const t=new Date(1e3*this.coupon.due_date).toISOString().split("T");[this.dueDate]=t},dueDate(){this.coupon.due_date=Math.floor(new Date(this.dueDate)/1e3)}},data(){return{coupon:{},dueDate:""}},computed:{...(0,B.aH)(O,["tempCoupon"])},methods:{...(0,B.i0)(O,["updateCoupon"]),sendUpdateCoupon(){this.updateCoupon(this.coupon),this.hideModal()}}},q=o(6262);const z=(0,q.A)(Y,[["render",J]]);var G=z,Q=o(9060),R={components:{CouponModal:G,PageNavigation:Q.A},computed:{...(0,B.aH)(O,["coupons","pagination","isNew","isLoading"])},methods:{...(0,B.i0)(O,["getCoupons","getCoupon","comfirmDelCoupon"]),openModal(t,e){this.getCoupon(t,e),this.$refs.CouponModal.showModal()},openDelModal(t){this.tempCoupon=t,this.$refs.DelCouponModal.showModal()}},created(){this.getCoupons()}};const W=(0,q.A)(R,[["render",m]]);var Z=W}}]);
//# sourceMappingURL=462.21815765.js.map