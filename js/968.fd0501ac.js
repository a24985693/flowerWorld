"use strict";(self["webpackChunkfinal_hw"]=self["webpackChunkfinal_hw"]||[]).push([[968],{7649:function(t,e,s){s(4114);var a=s(4445),i=s(1250),o=s(9325),r=s(8465),n=s.n(r),c=s(9040);const l=(0,c.A)();e.A=(0,a.nY)("cart",{state:()=>({cart:{},cartLength:"",couponWarning:"",btnLoading:"",isLoading:!1}),actions:{getCart(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cms67/cart";i.A.get(t).then((t=>{this.isLoading=!1,this.cart=t.data.data,this.cartLength=this.cart.carts.length})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車取得失敗"})}))},updateCart(t,e){this.isLoading=!0;let s=e;s>20?s=20:s<1&&(s=1);const a=`https://vue3-course-api.hexschool.io/api/cms67/cart/${t.id}`,o={product_id:t.product_id,qty:s};i.A.put(a,{data:o}).then((()=>{this.getCart()})).catch((()=>{l.pushMessage({style:"danger",title:"數量修改失敗"})}))},addtoCart(t,e=1){let s;this.btnLoading=t.id,this.cart.carts?s=this.cart.carts.filter((e=>e.product_id===t.id)):this.getCart();const a="https://vue3-course-api.hexschool.io/api/cms67/cart",o={product_id:t.id,qty:e};i.A.post(a,{data:o}).then((t=>{this.btnLoading="";const{title:e}=t.data.data.product;if(t.data.data.qty>20){const t="已加入到最大數量";l.pushMessage({style:"warning",title:t,content:`購物車內目前已有20件${e}`}),this.updateCart(s[0],20)}else{const t="加入成功";l.pushMessage({style:"success",title:t,content:`已將${e}加入購物車`}),this.getCart()}})).catch((()=>{this.btnLoading="",l.pushMessage({style:"danger",title:"購物車加入失敗"})}))},deleteCartItem(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/cart/${t.id}`;i.A.delete(e).then((()=>{this.getCart();const e="已移除品項";l.pushMessage({style:"danger",title:e,content:`已將${t.product.title}移除`})})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車刪除失敗"})}))},confirmDeleteAll(){n().fire({text:"確定要將清空購物車嗎",icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.deleteAll()}))},deleteAll(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cms67/carts";i.A.delete(t).then((()=>{this.getCart();const t="已移除全部品項";l.pushMessage({style:"danger",title:t,content:"已將全部品項移除"})})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"購物車刪除失敗"})}))},addCouponCode(t){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/cms67/coupon",s={code:t};i.A.post(e,{data:s}).then((t=>{t.data.success?(this.getCart(),this.couponWarning=""):(this.isLoading=!1,this.couponWarning="找不到優惠券")})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"優惠券加入失敗"})}))},returnPage(){o.A.go(-1)},returnIndex(){o.A.push("/index")},gotoShop(){o.A.push("/productsList")}}})},3497:function(t,e,s){s(4114);var a=s(4445),i=s(1250),o=s(9325),r=s(8465),n=s.n(r),c=s(9040);const l=(0,c.A)();e.A=(0,a.nY)("order",{state:()=>({couponCode:"",order:{user:{}},originalTotal:0,searchOrder:{},warning:"",isLoading:!1}),actions:{createOrder(t){this.isLoading=!0;const e="https://vue3-course-api.hexschool.io/api/cms67/order";i.A.post(e,{data:t}).then((t=>{this.isLoading=!1,o.A.push(`/checkout/${t.data.orderId}`)})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"訂單建立失敗"})}))},confirmCreateOrder(t){n().fire({title:"確定表單資料",text:"表單送出後將不能修改訂單!",icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((e=>{e.isConfirmed&&this.createOrder(t)}))},getOrder(t,e){if(this.isLoading=!0,t){const s=`https://vue3-course-api.hexschool.io/api/cms67/order/${t}`;i.A.get(s).then((t=>{if(this.isLoading=!1,t.data.order){e?this.searchOrder=t.data.order:this.order=t.data.order;const s=Object.keys(t.data.order.products)[0],a=t.data.order.products[s];a.coupon&&(this.couponCode=a.coupon.code)}else this.warning="訂單號碼輸入錯誤，請重新輸入";this.getOriginalTotal(t.data.order)})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"訂單取得失敗"})}))}else this.isLoading=!1,this.warning="訂單號碼不可為空，請輸入訂單號碼"},getOriginalTotal(t){const e=Object.values(t.products).map((t=>t.total));this.originalTotal=0,e.forEach((t=>{this.originalTotal+=t}))},payOrder(){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/cms67/pay/${this.order.id}`;i.A.post(t).then((t=>{if(this.isLoading=!1,t.data.success){this.getOrder(this.order.id);const t="付款成功";l.pushMessage({style:"success",title:t,content:"已完成付款"})}})).catch((()=>{this.isLoading=!1,l.pushMessage({style:"danger",title:"付款失敗"})}))},gotoPay(t){o.A.push(`/checkout/${t}`)}}})},3864:function(t,e,s){s(4114);var a=s(4445),i=s(1250),o=s(9325),r=s(9040);const n=(0,r.A)();e.A=(0,a.nY)("product",{state:()=>({product:{},preferProducts:[],products:[],pagination:{},ProductsArr:[],renderProducts:[],newData:[],tempCategory:"",isLoading:!1}),actions:{getProduct(t){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/product/${t}`;i.A.get(e).then((t=>{this.isLoading=!1,this.product=t.data.product})).catch((()=>{this.isLoading=!1,n.pushMessage({style:"danger",title:"商品取得失敗"})}))},getPreferProducts(){this.isLoading=!0;const t="https://vue3-course-api.hexschool.io/api/cms67/products";i.A.get(t).then((t=>{this.preferProducts=t.data.products})).catch((()=>{this.isLoading=!1,n.pushMessage({style:"danger",title:"推薦商品取得失敗"})}))},getProducts(t=1){this.isLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/cms67/products?page=${t}`;i.A.get(e).then((e=>{this.products=e.data.products,this.pagination=e.data.pagination,this.pagination.category=this.tempCategory||"全部",this.products.forEach((t=>{this.ProductsArr.push(t)})),this.renderProducts=[...this.ProductsArr],this.renderCategory(t)})).catch((()=>{this.isLoading=!1,n.pushMessage({style:"danger",title:"商品取得失敗"})}))},renderCategory(t){t<this.pagination.total_pages?this.getProducts(t+1):(this.isLoading=!1,"全部"!==this.pagination.category&&(this.renderProducts=this.ProductsArr.filter((t=>t.category===this.pagination.category))),this.newData=[],this.renderProducts.forEach(((t,e)=>{e%10===0&&this.newData.push([]);const s=parseInt(e/10,10);this.newData[s].push(t)})),this.pagination.current_page=1,this.pagination.total_pages=this.newData.length,this.sortProducts=this.renderProducts,this.ProductsArr=[])},sort(t){"low"===t?this.renderProducts.sort(((t,e)=>t.price-e.price)):this.renderProducts.sort(((t,e)=>e.price-t.price)),this.ProductsArr=this.renderProducts,this.renderCategory()},updateCategory(t){this.tempCategory=t},gotoProduct(t){o.A.push(`/product/${t}`)},getPage(t){this.pagination.current_page=t,window.scrollTo(0,0)}}})},5968:function(t,e,s){s.r(e),s.d(e,{default:function(){return et}});var a=s(641),i=s(33),o=s(3751);const r={class:"page-title"},n=(0,a.Lk)("h2",null,"填寫資料",-1),c={"aria-label":"breadcrumb"},l={class:"breadcrumb d-flex justify-content-center"},d={class:"breadcrumb-item"},u=(0,a.Lk)("li",{class:"breadcrumb-item active"}," 填寫資料 ",-1),h={class:"container"},p=(0,a.Fv)('<div class="row justify-content-center text-center mb-5"><div class="col-4 col-md-3"><div class="pay-step border"><span>1</span></div><span>確認訂單</span></div><div class="col-4 col-md-3"><div class="pay-step bg-info text-white"><span>2</span></div><span>填寫資料</span></div><div class="col-4 col-md-3"><div class="pay-step border"><span>3</span></div><span>付款</span></div></div>',1),g={class:"row justify-content-center g-4"},m={class:"col-12 col-lg-8"},f={class:"border border-2 border-info"},L=(0,a.Lk)("div",{class:"w-100 bg-info text-white fs-5 text-center py-2"}," 填寫資料 ",-1),b={class:"py-4 px-3"},v={class:"mb-3"},y=(0,a.Lk)("label",{for:"inputEmail",id:"emailLabel",class:"form-label w-100"},"Email*",-1),k={class:"mb-3"},C=(0,a.Lk)("label",{for:"inputName",class:"form-label w-100"},"收件人姓名*",-1),x={class:"mb-3"},w=(0,a.Lk)("label",{for:"inputPhone",class:"form-label w-100"},"收件人電話*",-1),A={class:"mb-3"},P=(0,a.Lk)("label",{for:"inputAddress",class:"form-label w-100"},"收件人地址*",-1),_={class:"mb-4"},$={for:"inputComment",class:"form-label w-100"},M={class:"col-12 col-lg-4"},F={class:"border border-2 border-info"},O=(0,a.Lk)("div",{class:"w-100 bg-info text-white fs-5 text-center py-2"}," 訂單明細 ",-1),V={class:"py-4 px-3"},E={class:"col-5"},T={class:"col-2 text-center"},j={class:"col-5 text-end"},q={class:"my-3"},W={class:"d-flex justify-content-between mb-1"},B=(0,a.Lk)("p",null,"小計",-1),D={key:0,class:"d-flex justify-content-between text-muted mb-1"},I=(0,a.Lk)("p",null,"折扣",-1),N={key:1,class:"d-flex justify-content-between text-muted"},U=(0,a.Lk)("p",null,"已套用優惠券",-1),X=(0,a.Lk)("hr",null,null,-1),S={class:"d-flex justify-content-between fs-5 fw-semibold mb-3"},Y=(0,a.Lk)("p",null,"總計",-1),K=(0,a.Lk)("button",{type:"submit",class:"btn btn-secondary w-100 fw-bold"},[(0,a.eW)(" 下一步 "),(0,a.Lk)("i",{class:"fa-solid fa-angle-right"})],-1);function Q(t,e,s,Q,H,J){const z=(0,a.g2)("LoadingSpinner"),G=(0,a.g2)("router-link"),R=(0,a.g2)("VerifyField"),Z=(0,a.g2)("ErrorMessage"),tt=(0,a.g2)("VerifyForm");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(z,{active:t.isLoading},null,8,["active"]),(0,a.Lk)("section",r,[n,(0,a.Lk)("nav",c,[(0,a.Lk)("ol",l,[(0,a.Lk)("li",d,[(0,a.bF)(G,{to:"/",class:"text-decoration-none text-light"},{default:(0,a.k6)((()=>[(0,a.eW)(" 首頁 ")])),_:1})]),u])])]),(0,a.Lk)("div",h,[p,(0,a.bF)(tt,{onSubmit:J.sendCreateOrder},{default:(0,a.k6)((({errors:s})=>[(0,a.Lk)("div",g,[(0,a.Lk)("div",m,[(0,a.Lk)("div",f,[L,(0,a.Lk)("div",b,[(0,a.Lk)("div",v,[y,(0,a.bF)(R,{type:"email",class:(0,i.C4)(["form-control",{"is-invalid":s["email"]}]),id:"inputEmail",rules:"email|required",name:"email",placeholder:"請輸入Email",modelValue:H.form.user.email,"onUpdate:modelValue":e[0]||(e[0]=t=>H.form.user.email=t),"aria-label":"Email"},null,8,["class","modelValue"]),(0,a.bF)(Z,{name:"email",class:"invalid-feedback"})]),(0,a.Lk)("div",k,[C,(0,a.bF)(R,{type:" text",class:(0,i.C4)(["form-control",{"is-invalid":s["姓名"]}]),id:"inputName",rules:"required",name:"姓名",placeholder:"請輸入姓名",modelValue:H.form.user.name,"onUpdate:modelValue":e[1]||(e[1]=t=>H.form.user.name=t)},null,8,["class","modelValue"]),(0,a.bF)(Z,{name:"姓名",class:"invalid-feedback"})]),(0,a.Lk)("div",x,[w,(0,a.bF)(R,{type:"tel",class:(0,i.C4)(["form-control",{"is-invalid":s["電話"]}]),id:"inputPhone",rules:"required",name:"電話",placeholder:"請輸入電話",modelValue:H.form.user.tel,"onUpdate:modelValue":e[2]||(e[2]=t=>H.form.user.tel=t)},null,8,["class","modelValue"]),(0,a.bF)(Z,{name:"電話",class:"invalid-feedback"})]),(0,a.Lk)("div",A,[P,(0,a.bF)(R,{type:"text",class:(0,i.C4)(["form-control",{"is-invalid":s["地址"]}]),id:"inputAddress",rules:"required",name:"地址",placeholder:"請輸入地址",modelValue:H.form.user.address,"onUpdate:modelValue":e[3]||(e[3]=t=>H.form.user.address=t)},null,8,["class","modelValue"]),(0,a.bF)(Z,{name:"地址",class:"invalid-feedback"})]),(0,a.Lk)("div",_,[(0,a.Lk)("label",$,[(0,a.eW)("留言 "),(0,a.bo)((0,a.Lk)("textarea",{type:"email",class:"form-control",id:"inputComment","onUpdate:modelValue":e[4]||(e[4]=t=>H.form.message=t)},null,512),[[o.Jo,H.form.message]])])]),(0,a.Lk)("div",null,[(0,a.bF)(G,{to:"/cart",class:"fw-semibold link-gray"},{default:(0,a.k6)((()=>[(0,a.eW)(" 回上一步 ")])),_:1})])])])]),(0,a.Lk)("div",M,[(0,a.Lk)("div",F,[O,(0,a.Lk)("div",V,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.cart.carts,(e=>((0,a.uX)(),(0,a.CE)("div",{key:e.id,class:"row align-items-center border-bottom py-2"},[(0,a.Lk)("p",E,(0,i.v_)(e.product.title),1),(0,a.Lk)("p",T,"x"+(0,i.v_)(e.qty),1),(0,a.Lk)("p",j," NT$"+(0,i.v_)(t.$filters.currency(e.total)),1)])))),128)),(0,a.Lk)("div",q,[(0,a.Lk)("div",W,[B,(0,a.Lk)("p",null,"NT$"+(0,i.v_)(t.$filters.currency(t.cart.total)),1)]),t.cart.final_total!==t.cart.total?((0,a.uX)(),(0,a.CE)("div",D,[I,(0,a.Lk)("p",null,(0,i.v_)(t.$filters.currency(t.cart.total-t.cart.final_total)),1)])):(0,a.Q3)("",!0),t.cart.final_total!==t.cart.total?((0,a.uX)(),(0,a.CE)("div",N,[U,(0,a.Lk)("p",null,(0,i.v_)(t.cart.carts[0].coupon.code),1)])):(0,a.Q3)("",!0)]),X,(0,a.Lk)("div",S,[Y,(0,a.Lk)("p",null,"NT$"+(0,i.v_)(t.$filters.currency(t.cart.final_total)),1)]),K])])])])])),_:1},8,["onSubmit"])])],64)}var H=s(3864),J=s(7649),z=s(3497),G=s(4445),R={data(){return{form:{user:{name:"",email:"",tel:"",address:""},message:""}}},computed:{...(0,G.aH)(J.A,["cart","isLoading"])},methods:{...(0,G.i0)(H.A,["gotoProduct"]),...(0,G.i0)(J.A,["getCart"]),...(0,G.i0)(z.A,["confirmCreateOrder"]),sendCreateOrder(){this.confirmCreateOrder(this.form)}},created(){this.getCart()}},Z=s(6262);const tt=(0,Z.A)(R,[["render",Q]]);var et=tt}}]);
//# sourceMappingURL=968.fd0501ac.js.map