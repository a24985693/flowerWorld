"use strict";(self["webpackChunkfinal_hw"]=self["webpackChunkfinal_hw"]||[]).push([[578],{7578:function(e,t,s){s.r(t),s.d(t,{default:function(){return S}});var a=s(641),d=s(33);const o={class:"table-responsive"},i={class:"table text-nowrap"},n=(0,a.Lk)("thead",null,[(0,a.Lk)("tr",null,[(0,a.Lk)("th",{scope:"col"},"訂單編號"),(0,a.Lk)("th",{scope:"col"},"Email"),(0,a.Lk)("th",{scope:"col"},"購買項目"),(0,a.Lk)("th",{scope:"col"},"應付金額"),(0,a.Lk)("th",{scope:"col"},"是否付款"),(0,a.Lk)("th",{scope:"col"},"編輯")])],-1),r={scope:"row"},l={class:"list-unstyled"},c={key:0,class:"text-success"},u={key:1,class:"text-muted"},p={class:"btn-group"},h=["onClick"],g=["onClick"];function m(e,t,s,m,k,L){const b=(0,a.g2)("LoadingSpinner"),O=(0,a.g2)("OrderModal"),v=(0,a.g2)("PageNavigation");return(0,a.uX)(),(0,a.CE)(a.FK,null,[(0,a.bF)(b,{active:e.isLoading},null,8,["active"]),(0,a.Lk)("div",o,[(0,a.Lk)("table",i,[n,(0,a.Lk)("tbody",null,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(e.orders,(t=>((0,a.uX)(),(0,a.CE)("tr",{key:t.id},[(0,a.Lk)("td",r,(0,d.v_)(t.create_at),1),(0,a.Lk)("td",null,(0,d.v_)(t.user.email),1),(0,a.Lk)("td",null,[(0,a.Lk)("ul",l,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(t.products,((e,t)=>((0,a.uX)(),(0,a.CE)("li",{key:t}," 品名:"+(0,d.v_)(e.product.title)+" 數量:"+(0,d.v_)(e.product.num),1)))),128))])]),(0,a.Lk)("td",null,(0,d.v_)(e.$filters.currency(t.total)),1),(0,a.Lk)("td",null,[t.is_paid?((0,a.uX)(),(0,a.CE)("span",c,"已付款")):((0,a.uX)(),(0,a.CE)("span",u,"未付款"))]),(0,a.Lk)("td",null,[(0,a.Lk)("div",p,[(0,a.Lk)("button",{class:"btn btn-outline-gray btn-sm",type:"button",onClick:e=>L.openModal(t)},"編輯",8,h),(0,a.Lk)("button",{class:"btn btn-outline-danger btn-sm",type:"button",onClick:s=>e.comfirmDelOrder(t)},"刪除",8,g)])])])))),128))])])]),(0,a.bF)(O,{ref:"OrderModal"},null,512),(0,a.bF)(v,{pagination:e.pagination,onUpdatePage:e.getOrders},null,8,["pagination","onUpdatePage"])],64)}var k=s(3751);const L={class:"modal fade",id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},b={class:"modal-dialog",role:"document"},O={class:"modal-content border-0"},v=(0,a.Lk)("div",{class:"modal-header bg-dark text-white"},[(0,a.Lk)("h5",{class:"modal-title",id:"exampleModalLabel"},"編輯訂單"),(0,a.Lk)("button",{type:"button",class:"btn-close text-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),y={class:"modal-body"},f={class:"modal-body"},M={class:"mb-3"},C=(0,a.Lk)("label",{for:"total"},"請輸入金額",-1),x={class:"mb-3"},_=(0,a.Lk)("label",{for:"is_paid"},"是否付款",-1),w={class:"modal-footer"},E=(0,a.Lk)("button",{type:"button",class:"btn btn-gray","data-bs-dismiss":"modal"},"取消",-1);function A(e,t,s,d,o,i){return(0,a.uX)(),(0,a.CE)("div",L,[(0,a.Lk)("div",b,[(0,a.Lk)("div",O,[v,(0,a.Lk)("div",y,[(0,a.Lk)("div",f,[(0,a.Lk)("div",M,[C,(0,a.bo)((0,a.Lk)("input",{type:"number",class:"form-control",id:"total","onUpdate:modelValue":t[0]||(t[0]=e=>o.order.total=e)},null,512),[[k.Jo,o.order.total]])]),(0,a.Lk)("div",x,[(0,a.bo)((0,a.Lk)("input",{type:"checkbox",class:"form-check-input",id:"is_paid","onUpdate:modelValue":t[1]||(t[1]=e=>o.order.is_paid=e)},null,512),[[k.lH,o.order.is_paid]]),_])])]),(0,a.Lk)("div",w,[E,(0,a.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>i.sendUpdateOrder&&i.sendUpdateOrder(...e))},"確認")])])])],512)}var X=s(3286),U=s(4445),F=s(1250),$=s(8465),P=s.n($),B=s(9040);const D=(0,B.A)();var H=(0,U.nY)("adminOrder",{state:()=>({orders:{},tempOrder:{},pagination:{},isLoading:!1}),actions:{getOrders(e=1){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/cms67/admin/orders?page=${e}`;F.A.get(t).then((e=>{this.isLoading=!1,this.orders=e.data.orders,this.pagination=e.data.pagination})).catch((()=>{this.isLoading=!1,D.pushMessage({style:"danger",title:"訂單列表取得失敗",content:"請稍後嘗試"})}))},getOrder(e){this.tempOrder={...e}},updateOrder(e){if(e.total>0){this.isLoading=!0,this.tempOrder=e;const t=`https://vue3-course-api.hexschool.io/api/cms67/admin/order/${e.id}`;F.A.put(t,{data:this.tempOrder}).then((e=>{let t="更新成功";e.data.success?(this.getOrders(),D.pushMessage({style:"success",title:t})):(this.isLoading=!1,t="更新失敗",D.pushMessage({style:"danger",title:t,content:e.data.message.join("、")}))})).catch((()=>{this.isLoading=!1,D.pushMessage({style:"danger",title:"更新失敗",content:"請稍後嘗試"})}))}else this.isLoading=!1,D.pushMessage({style:"danger",title:"金額不正確，請重新輸入"})},comfirmDelOrder(e){P().fire({title:"確定刪除嗎",text:`確定要${e.paid_date}刪除嗎`,icon:"warning",cancelButtonText:"取消",confirmButtonText:"確定",showCancelButton:!0}).then((t=>{t.isConfirmed&&this.deleteOrder(e)}))},deleteOrder(e){this.isLoading=!0;const t=`https://vue3-course-api.hexschool.io/api/cms67/admin/order/${e.id}`;F.A.delete(t).then((e=>{this.getOrders(),e.data.success?D.pushMessage({style:"success",title:"刪除成功"}):(this.isLoading=!1,D.pushMessage({style:"danger",title:"刪除失敗",content:e.data.message.join("、")}))})).catch((()=>{this.isLoading=!1,D.pushMessage({style:"danger",title:"刪除失敗",content:"請稍後嘗試"})}))}}}),K={mixins:[X.A],watch:{tempOrder(){this.order=this.tempOrder}},data(){return{order:{}}},computed:{...(0,U.aH)(H,["tempOrder"])},methods:{...(0,U.i0)(H,["updateOrder"]),sendUpdateOrder(){this.updateOrder(this.order),this.hideModal()}}},j=s(6262);const I=(0,j.A)(K,[["render",A]]);var N=I,T=s(9060),V={components:{OrderModal:N,PageNavigation:T.A},computed:{...(0,U.aH)(H,["orders","pagination","isLoading"])},methods:{...(0,U.i0)(H,["getOrders","getOrder","comfirmDelOrder"]),openModal(e){this.getOrder(e),this.$refs.OrderModal.showModal()}},created(){this.getOrders()}};const J=(0,j.A)(V,[["render",m]]);var S=J}}]);
//# sourceMappingURL=578.71c2ba0e.js.map